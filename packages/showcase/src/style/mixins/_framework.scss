@use "sass:map";
@use "./elements" as *;
@use "./helpers" as *;
@use "../_variables" as *;

/*******************************************
 * @mixin lf-fw-backdrop
 * Creates a full-screen backdrop element with a fade-in-out transition.
 *******************************************/
@mixin lf-fw-backdrop {
  [data-lf="backdrop"] {
    @include lf-el-transition("fade-in-out");

    background: rgba(0, 0, 0, 0.375);
    height: 100vh;
    left: 0;
    opacity: 0;
    position: fixed;
    top: 0;
    width: 100vw;
    z-index: var(--lf-ui-zindex-backdrop, 899);

    @include lf-keyframe(lf-fade-in, map.get($lf-keyframes, fade-in));
  }
}
/*******************************************
 * @mixin lf-fw-fade-in
 * Applies a fade-in animation to any element with [data-lf="fade-in"].
 *
 * @param {String} $display - Which display property to use (e.g. "block", "flex").
 *                            Defaults to "block".
 *******************************************/
@mixin lf-fw-fade-in($display: block) {
  [data-lf="fade-in"] {
    display: $display;
    animation: lf-fade-in-#{$display} 0.25s ease-out forwards;
    @include lf-keyframe(
      lf-fade-in-#{$display},
      map.get($lf-keyframes, fade-in)
    );
  }
}
/*******************************************
 * @mixin lf-fw-lightbox
 * Creates a fixed-position lightbox container for modal content.
 *******************************************/
@mixin lf-fw-lightbox {
  [data-lf="lightbox"] {
    @include lf-el-transition("fade-in-out");
    height: 90dvh;
    left: 5dvw;
    position: fixed;
    top: 5dvh;
    width: 90dvw;
    z-index: var(--lf-ui-zindex-lightbox, 900);
  }

  [data-lf="lightbox-content"] {
    @include lf-el-stretch;
    border: 1px solid rgba(var(--lf-color-border), 0.375);
    border-radius: var(--lf-ui-border-radius);
    box-sizing: border-box;
    outline: none;
    z-index: calc(var(--lf-ui-zindex-lightbox, 900) + 1);

    @include lf-keyframe(lf-pop, map.get($lf-keyframes, pop));
  }
}
/*******************************************
 * @mixin lf-fw-neon-glow-apply
 * Applies animated neon glow effect directly to the current selector.
 * Use this mixin inside shadow DOM components or with ::part() selectors.
 *
 * @param {Color} $color - Neon glow color. Defaults to CSS var or fallback.
 * @param {Number} $intensity - Glow intensity (0-1). Defaults to 0.7.
 * @param {Time} $pulse-duration - Animation cycle duration. Defaults to 2s.
 *******************************************/
@mixin lf-fw-neon-glow-apply(
  $color: var(--lf-ui-neon-color, #00ffcc),
  $intensity: var(--lf-ui-neon-intensity, 0.7),
  $pulse-duration: var(--lf-ui-neon-pulse-duration, 8s)
) {
  & {
    position: relative;
    animation:
      lf-neon-pulse #{$pulse-duration} ease-in-out infinite,
      lf-neon-flicker calc(#{$pulse-duration} * 1.5) linear infinite;
    border: 2px solid #{$color};
    border-radius: var(--lf-ui-border-radius, 0.5em);
    transition: box-shadow 0.3s ease;
    box-shadow:
      0 0 3px #{$color},
      0 0 6px #{$color},
      0 0 12px #{$color},
      0 0 24px #{$color};

    @include lf-keyframe(lf-neon-pulse, map.get($lf-keyframes, neon-pulse));
    @include lf-keyframe(lf-neon-flicker, map.get($lf-keyframes, neon-flicker));
  }

  // Inner glow pseudo-element
  &::before {
    content: "";
    position: absolute;
    inset: -1px;
    border-radius: inherit;
    padding: 2px;
    background: linear-gradient(135deg, #{$color}, transparent 50%, #{$color});
    mask:
      linear-gradient(#fff 0 0) content-box,
      linear-gradient(#fff 0 0);
    mask-composite: exclude;
    -webkit-mask-composite: xor;
    pointer-events: none;
    opacity: #{$intensity};
  }
}
/*******************************************
 * @mixin lf-fw-neon-glow
 * Adds animated neon glow effect with pulsating border and optional reflection.
 * Supports "outline" (border only) and "filled" (with background) modes.
 * Use for global styles targeting [data-lf="neon-glow"] attribute.
 *
 * @param {Color} $default-color - Fallback neon color if CSS var not set.
 *******************************************/
@mixin lf-fw-neon-glow($default-color: #00ffcc) {
  [data-lf="neon-glow"] {
    --lf-ui-neon-color: #{$default-color};
    --lf-ui-neon-intensity: 0.7;
    --lf-ui-neon-pulse-duration: 8s;

    position: relative;
    animation:
      lf-neon-pulse var(--lf-ui-neon-pulse-duration) ease-in-out infinite,
      lf-neon-flicker calc(var(--lf-ui-neon-pulse-duration) * 1.5) linear
        infinite;
    border: 2px solid var(--lf-ui-neon-color);
    border-radius: var(--lf-ui-border-radius, 0.5em);
    transition: box-shadow 0.3s ease;

    @include lf-keyframe(lf-neon-pulse, map.get($lf-keyframes, neon-pulse));
    @include lf-keyframe(lf-neon-flicker, map.get($lf-keyframes, neon-flicker));

    // Outline mode (default)
    &[data-lf-neon-mode="outline"] {
      background: transparent;
    }

    // Filled mode
    &[data-lf-neon-mode="filled"] {
      background: color-mix(
        in srgb,
        var(--lf-ui-neon-color) calc(var(--lf-ui-neon-intensity) * 15%),
        transparent
      );
      backdrop-filter: blur(4px);
    }

    // Inner glow pseudo-element
    &::before {
      content: "";
      position: absolute;
      inset: -1px;
      border-radius: inherit;
      padding: 2px;
      background: linear-gradient(
        135deg,
        var(--lf-ui-neon-color),
        transparent 50%,
        var(--lf-ui-neon-color)
      );
      mask:
        linear-gradient(#fff 0 0) content-box,
        linear-gradient(#fff 0 0);
      mask-composite: exclude;
      -webkit-mask-composite: xor;
      pointer-events: none;
      opacity: var(--lf-ui-neon-intensity);
    }

    // Text glow for child text elements
    & > * {
      text-shadow:
        0 0 5px var(--lf-ui-neon-color),
        0 0 10px var(--lf-ui-neon-color),
        0 0 20px var(--lf-ui-neon-color);
    }
  }

  // Reflection element styling
  [data-lf="neon-glow-reflection"] {
    // Base styling - fixed position because we use viewport coordinates from getBoundingClientRect
    position: fixed;
    pointer-events: none;
    z-index: -1;

    // Reflection-specific CSS variable defaults
    --lf-ui-neon-reflection-blur: 8px;
    --lf-ui-neon-reflection-offset: 4px;
    --lf-ui-neon-reflection-opacity: 0.3;

    // Reflection effect
    transform: scaleY(-1);
    mask-image: linear-gradient(to bottom, rgba(0, 0, 0, 0.5), transparent);
    -webkit-mask-image: linear-gradient(
      to bottom,
      rgba(0, 0, 0, 0.5),
      transparent
    );
    filter: blur(var(--lf-ui-neon-reflection-blur));
    opacity: var(--lf-ui-neon-reflection-opacity);

    // Glow effect
    box-shadow:
      0 0 20px var(--lf-ui-neon-color),
      0 0 40px var(--lf-ui-neon-color);

    // Animation - sync with main element timing
    animation: lf-neon-pulse var(--lf-ui-neon-pulse-duration, 8s) ease-in-out
      infinite;

    @include lf-keyframe(lf-neon-pulse, map.get($lf-keyframes, neon-pulse));
  }
}
/*******************************************
 * @mixin lf-fw-neon-glow-surface
 * Defines a container that clips the neon glow effect properly.
 *******************************************/
@mixin lf-fw-neon-glow-surface {
  [data-lf="neon-glow-surface"] {
    position: relative;
    overflow: visible;
    isolation: isolate;
  }
}
/*******************************************
 * @mixin lf-fw-portal
 * Simple conditional portal display mixin.
 *
 * @param {Boolean} $active - If true, displays the portal; if false, hides it (display: none).
 *******************************************/
@mixin lf-fw-portal($active: false) {
  [data-lf="portal"] {
    display: if($active, block, none);

    @if $active {
      height: auto;
      max-height: 45dvh;
      max-width: 45dvw;
      overflow: auto;
      position: fixed;
      width: auto;
      z-index: var(--lf-ui-zindex-portal);

      @media (max-width: 600px) {
        max-height: 80dvh;
        max-width: 90dvw;
      }
    }
  }
}
/*******************************************
 * @mixin lf-fw-ripple
 * Defines a ripple element and its animation for material-style click feedback.
 *******************************************/
@mixin lf-fw-ripple {
  [data-lf="ripple"] {
    animation-duration: var(--lf-ui-duration-ripple, 675ms);
    animation-fill-mode: forwards;
    animation-name: lf-ripple;
    animation-timing-function: var(--lf-ui-timing-ripple, ease-out);
    background: var(--lf-ui-ripple-background, var(--lf-color-primary));
    border-radius: var(--lf-ui-radius-ripple, 50%);
    height: var(--lf-ui-ripple-height, 100%);
    left: var(--lf-ui-ripple-x, 50%);
    opacity: var(--lf-ui-opacity-ripple, 0.5);
    pointer-events: none;
    position: absolute;
    top: var(--lf-ui-ripple-y, 50%);
    transform: scale(0);
    width: var(--lf-ui-ripple-width, 100%);

    @include lf-keyframe(lf-ripple, map.get($lf-keyframes, ripple));
  }
}
/*******************************************
 * @mixin lf-fw-ripple-surface
 * Defines a container for ripple elements (i.e., the clickable surface).
 *******************************************/
@mixin lf-fw-ripple-surface {
  [data-lf="ripple-surface"] {
    cursor: pointer;
    height: 100%;
    left: 0;
    overflow: hidden;
    position: absolute;
    top: 0;
    width: 100%;
  }
}
/*******************************************
 * @mixin lf-fw-state-colors
 * Dynamically sets custom properties for various "states" (hover, active, disabled, etc.)
 * Each state in $lf-states-colors maps to a base color variable and an optional "rgb" variant.
 *
 * @param {String} $comp - Component ID/key (used for namespacing the custom props).
 *******************************************/
@mixin lf-fw-state-colors($comp) {
  @each $state, $colors in $lf-states-colors {
    [data-lf="#{$state}"] {
      @if $state != "primary" {
        @if $state == "disabled" {
          opacity: var(
            --lf-#{$comp}-ui-opacity-disabled,
            var(--lf-ui-opacity-disabled)
          );
          pointer-events: none;
        } @else {
          @each $key, $base-var in $colors {
            --lf-#{$comp}-color-#{$key}: var(
              --lf-#{$comp}-color-#{$state},
              var(#{$base-var})
            );
          }
        }
      }
    }
  }
}
/*******************************************
 * @mixin lf-fw-tilt
 * Adds a 3D tilt/hover effect to the element, with a dynamic radial highlight.
 *
 * @param {Number} $intensity - (Unused directly here) Potentially used for scaling the tilt.
 * @param {Time}   $transition - Transition duration (e.g., 275ms).
 *******************************************/
@mixin lf-fw-tilt($intensity: 10, $transition: 275ms) {
  & {
    transform: rotateX(var(--lf-ui-tilt-y, 0)) rotateY(var(--lf-ui-tilt-x, 0));
    transition: transform #{$transition} ease-out;
    transform-style: preserve-3d;
    will-change: transform;
  }

  &::after {
    @include lf-el-stretch;
    background: transparent;
    content: "";
    left: 0;
    mix-blend-mode: screen;
    pointer-events: none;
    position: absolute;
    top: 0;
    transition:
      background $transition ease-out,
      box-shadow $transition ease-in;
  }

  &:hover {
    & {
      box-shadow: 0 15px 30px rgba(var(--lf-color-on-bg), 0.375);
    }

    &::after {
      background: radial-gradient(
        circle at var(--lf-ui-tilt-light-x, 50%) var(--lf-ui-tilt-light-y, 50%),
        rgba(var(--lf-color-primary), 0.275),
        transparent
      );
    }
  }
}
